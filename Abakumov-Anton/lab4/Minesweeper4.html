<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8" />
    <title>–ú—ñ–Ω–µ—Ä ‚Äì —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞ –≤–µ—Ä—Å—ñ—è</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background: #111827;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            color: #f9fafb;
        }

        .hralnyi-ekran {
            background: #1f2937;
            border-radius: 16px;
            padding: 20px 24px 24px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            min-width: 360px;
        }

        .zagolovok-hry {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 12px;
            text-align: center;
            letter-spacing: 0.06em;
            text-transform: uppercase;
            color: #e5e7eb;
        }

        .heder-hry {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
            margin-bottom: 16px;
        }

        .indykator {
            background: #020617;
            border-radius: 10px;
            padding: 6px 10px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.9);
        }

        .indykator-znachok {
            font-size: 16px;
        }

        .indykator-tekst {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.14em;
            color: #9ca3af;
        }

        .indykator-lychylka {
            font-family: "Courier New", monospace;
            font-size: 18px;
            letter-spacing: 0.12em;
            padding: 2px 4px;
            background: #020617;
            border-radius: 4px;
            color: #f97316;
            min-width: 56px;
            text-align: right;
        }

        .indykator-lychylka--prapory {
            color: #22c55e;
        }

        .knopka-nova-hra {
            background: #facc15;
            color: #111827;
            border-radius: 999px;
            border: none;
            padding: 7px 16px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.35);
            transition: transform 0.07s ease, box-shadow 0.07s ease, background 0.1s ease;
        }

        .knopka-nova-hra:active {
            transform: translateY(1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
            background: #eab308;
        }

        .knopka-nova-hra-emoji {
            font-size: 18px;
        }

        .status-hry {
            margin-top: 6px;
            text-align: center;
            font-size: 12px;
            letter-spacing: 0.14em;
            text-transform: uppercase;
            color: #9ca3af;
        }

        .status-hry--peremoga {
            color: #22c55e;
        }

        .status-hry--porazka {
            color: #f97316;
        }

        .pole-hry-wrapper {
            background: #020617;
            border-radius: 12px;
            padding: 10px;
            box-shadow: inset 0 0 0 1px #020617;
        }

        .pole-hry {
            display: grid;
            grid-auto-rows: 32px;
            gap: 3px;
            justify-content: center;
        }

        .klityna {
            width: 32px;
            height: 32px;
            border-radius: 4px;
            font-size: 18px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
            box-shadow:
                0 1px 0 rgba(0, 0, 0, 0.6),
                inset 0 0 0 1px rgba(15, 23, 42, 0.8);
        }

        .klityna-igrova {
            cursor: pointer;
        }

        .klityna--zakryta {
            background: linear-gradient(145deg, #1f2937, #0f172a);
        }

        .klityna--zakryta:hover {
            box-shadow:
                0 0 0 1px #38bdf8,
                0 0 12px rgba(56, 189, 248, 0.4);
        }

        .klityna--vidkryta {
            background: #e5e7eb;
            box-shadow:
                0 0 0 1px #9ca3af,
                inset 0 0 0 1px #d1d5db;
            color: #111827;
        }

        .klityna--prapor-mina {
            background: linear-gradient(145deg, #022c22, #064e3b);
            box-shadow:
                0 0 0 1px #16a34a,
                inset 0 0 0 1px #022c22;
            color: #facc15;
        }

        .klityna--prapor-pomylka {
            background: linear-gradient(145deg, #450a0a, #7f1d1d);
            box-shadow:
                0 0 0 1px #b91c1c,
                inset 0 0 0 1px #450a0a;
            color: #f9fafb;
        }

        .klityna--mina {
            background: #111827;
            box-shadow:
                0 0 0 1px #020617,
                inset 0 0 0 1px #020617;
            color: #f97316;
        }

        .klityna--mina-aktivna {
            background: radial-gradient(circle at center, #b91c1c 0, #7f1d1d 45%, #111827 100%);
            box-shadow:
                0 0 0 1px #fecaca,
                0 0 12px rgba(248, 113, 113, 0.8);
            color: #fee2e2;
        }

        .chyslo {
            font-weight: 800;
        }

        .chyslo--1 { color: #1d4ed8; }
        .chyslo--2 { color: #15803d; }
        .chyslo--3 { color: #b91c1c; }
        .chyslo--4 { color: #1e3a8a; }
        .chyslo--5 { color: #92400e; }
        .chyslo--6 { color: #0f766e; }
        .chyslo--7 { color: #0f172a; }
        .chyslo--8 { color: #4b5563; }

        .panel-staniv {
            margin-top: 16px;
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 8px 12px;
            font-size: 11px;
            color: #9ca3af;
        }

        .element-stanu {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .element-stanu-tekst {
            line-height: 1.3;
        }

        .element-stanu-nazva {
            font-weight: 600;
            color: #e5e7eb;
        }
    </style>
</head>
<body>
<main class="hralnyi-ekran">
    <div class="zagolovok-hry">
        –ú—ñ–Ω–µ—Ä
    </div>

    <header class="heder-hry">
        <div class="indykator" aria-label="–ö—ñ–ª—å–∫—ñ—Å—Ç—å –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –ø—Ä–∞–ø–æ—Ä—Ü—ñ–≤">
            <div class="indykator-znachok">üö©</div>
            <div>
                <div class="indykator-tekst">–ü—Ä–∞–ø–æ—Ä—Ü—ñ</div>
                <div class="indykator-lychylka indykator-lychylka--prapory"
                     data-flags-value>010</div>
            </div>
        </div>

        <button class="knopka-nova-hra" type="button" data-new-game>
            <span class="knopka-nova-hra-emoji">üôÇ</span>
            <span data-new-game-text>–°—Ç–∞—Ä—Ç</span>
        </button>

        <div class="indykator" aria-label="–¢–∞–π–º–µ—Ä –≥—Ä–∏">
            <div class="indykator-znachok">‚è±Ô∏è</div>
            <div>
                <div class="indykator-tekst">–ß–∞—Å</div>
                <div class="indykator-lychylka" data-timer-value>000</div>
            </div>
        </div>
    </header>

    <div class="status-hry" data-game-status>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å ¬´–°—Ç–∞—Ä—Ç¬ª</div>

    <section class="pole-hry-wrapper">
        <div class="pole-hry" data-game-field aria-label="–ü–æ–ª–µ –≥—Ä–∏ –ú—ñ–Ω–µ—Ä"></div>
    </section>

    <section class="panel-staniv">
        <div class="element-stanu">
            <div class="klityna klityna--zakryta"></div>
            <div class="element-stanu-tekst">
                <div class="element-stanu-nazva">–ó–∞–∫—Ä–∏—Ç–∞ –∫–ª—ñ—Ç–∏–Ω–∫–∞</div>
                <div>–ü–æ—á–∞—Ç–∫–æ–≤–∏–π —Å—Ç–∞–Ω, –ø–æ –Ω—ñ–π —â–µ –Ω–µ –∫–ª—ñ–∫–∞–ª–∏.</div>
            </div>
        </div>

        <div class="element-stanu">
            <div class="klityna klityna--vidkryta"><span class="chyslo chyslo--1">1</span></div>
            <div class="element-stanu-tekst">
                <div class="element-stanu-nazva">–í—ñ–¥–∫—Ä–∏—Ç–∞ –∫–ª—ñ—Ç–∏–Ω–∫–∞</div>
                <div>–ü–æ–∫–∞–∑—É—î –∫—ñ–ª—å–∫—ñ—Å—Ç—å –º—ñ–Ω —É —Å—É—Å—ñ–¥–Ω—ñ—Ö –∫–ª—ñ—Ç–∏–Ω–∫–∞—Ö.</div>
            </div>
        </div>

        <div class="element-stanu">
            <div class="klityna klityna--vidkryta"></div>
            <div class="element-stanu-tekst">
                <div class="element-stanu-nazva">–ü–æ—Ä–æ–∂–Ω—è –≤—ñ–¥–∫—Ä–∏—Ç–∞</div>
                <div>–ü–æ—Ä—É—á –Ω–µ–º–∞—î –∂–æ–¥–Ω–æ—ó –º—ñ–Ω–∏.</div>
            </div>
        </div>

        <div class="element-stanu">
            <div class="klityna klityna--prapor-mina">üö©</div>
            <div class="element-stanu-tekst">
                <div class="element-stanu-nazva">–ü—Ä–∞–ø–æ—Ä–µ—Ü—å –Ω–∞ –º—ñ–Ω—ñ</div>
                <div>–ü—Ä–∞–≤–∏–ª—å–Ω–∞ –ø–æ–∑–Ω–∞—á–∫–∞ –º—ñ–Ω–∏ –ø—Ä–∞–ø–æ—Ä—Ü–µ–º.</div>
            </div>
        </div>

        <div class="element-stanu">
            <div class="klityna klityna--prapor-pomylka">üö©</div>
            <div class="element-stanu-tekst">
                <div class="element-stanu-nazva">–ü—Ä–∞–ø–æ—Ä–µ—Ü—å –±–µ–∑ –º—ñ–Ω–∏</div>
                <div>–ü–æ–º–∏–ª–∫–æ–≤–∏–π –ø—Ä–∞–ø–æ—Ä–µ—Ü—å, –ø—ñ–¥ –Ω–∏–º –Ω–µ–º–∞—î –º—ñ–Ω–∏.</div>
            </div>
        </div>

        <div class="element-stanu">
            <div class="klityna klityna--mina">üí£</div>
            <div class="element-stanu-tekst">
                <div class="element-stanu-nazva">–ú—ñ–Ω–∞</div>
                <div>–í—ñ–¥–∫—Ä–∏—Ç–∞ –º—ñ–Ω–∞, –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è –ø—ñ—Å–ª—è –ø–æ—Ä–∞–∑–∫–∏.</div>
            </div>
        </div>

        <div class="element-stanu">
            <div class="klityna klityna--mina-aktivna">üí£</div>
            <div class="element-stanu-tekst">
                <div class="element-stanu-nazva">–ú—ñ–Ω–∞, –Ω–∞—Ç–∏—Å–Ω—É—Ç–∞ –≥—Ä–∞–≤—Ü–µ–º</div>
                <div>–ö–ª—ñ—Ç–∏–Ω–∫–∞, —á–µ—Ä–µ–∑ —è–∫—É —Å—Ç–∞–ª–∞—Å—è –ø–æ—Ä–∞–∑–∫–∞.</div>
            </div>
        </div>
    </section>
</main>

<script>
    function stvorytyKlitynku() {
        return {
            yeMina: false,
            kilkistSusidnihMin: 0,
            isOpened: false,
            isFlagged: false
        };
    }

    let poleHry = [];           
    let domKlitynky = [];       

    const stanHry = {
        shyryna: 0,
        vysota: 0,
        kilkistMin: 0,
        status: 'ne_pochata',           
        vidkrytiBezpechni: 0,
        zahalnaKilkistBezpechnih: 0,
        vstanovleniPraportsi: 0,
        minaPidryvRow: null,
        minaPidryvCol: null
    };

    let timerId = null;
    let secondsPassed = 0;

    const timerElement = document.querySelector('[data-timer-value]');
    const flagsElement = document.querySelector('[data-flags-value]');
    const gameFieldElement = document.querySelector('[data-game-field]');
    const newGameButton = document.querySelector('[data-new-game]');
    const newGameButtonText = document.querySelector('[data-new-game-text]');
    const statusElement = document.querySelector('[data-game-status]');

    function onovytyVidobrazhennyaTaimeru() {
        if (!timerElement) return;
        timerElement.textContent = String(secondsPassed).padStart(3, '0');
    }

    function startTimer() {
        if (timerId !== null) return;
        secondsPassed = 0;
        onovytyVidobrazhennyaTaimeru();
        timerId = setInterval(() => {
            secondsPassed++;
            onovytyVidobrazhennyaTaimeru();
        }, 1000);
    }

    function stopTimer() {
        if (timerId === null) return;
        clearInterval(timerId);
        timerId = null;
    }

    function vMezhahPolya(row, col) {
        return (
            row >= 0 && row < stanHry.vysota &&
            col >= 0 && col < stanHry.shyryna
        );
    }

    function countNeighbourMines(field, row, col) {
        const ryadky = field.length;
        const stovptsi = field[0].length;
        let kilkist = 0;

        for (let dy = -1; dy <= 1; dy++) {
            for (let dx = -1; dx <= 1; dx++) {
                if (dy === 0 && dx === 0) continue;
                const ny = row + dy;
                const nx = col + dx;
                const vMezhah =
                    ny >= 0 && ny < ryadky &&
                    nx >= 0 && nx < stovptsi;
                if (vMezhah && field[ny][nx].yeMina) {
                    kilkist++;
                }
            }
        }

        return kilkist;
    }

    function generateField(rows, cols, mines) {
        const field = [];

        for (let y = 0; y < rows; y++) {
            const ryadok = [];
            for (let x = 0; x < cols; x++) {
                ryadok.push(stvorytyKlitynku());
            }
            field.push(ryadok);
        }

        let rozmishchenoMin = 0;
        while (rozmishchenoMin < mines) {
            const randRow = Math.floor(Math.random() * rows);
            const randCol = Math.floor(Math.random() * cols);
            if (!field[randRow][randCol].yeMina) {
                field[randRow][randCol].yeMina = true;
                rozmishchenoMin++;
            }
        }

        for (let y = 0; y < rows; y++) {
            for (let x = 0; x < cols; x++) {
                field[y][x].kilkistSusidnihMin = countNeighbourMines(field, y, x);
            }
        }

        return field;
    }

    function perevirytyPeremohu() {
        if (
            stanHry.status === 'u_protsesi' &&
            stanHry.vidkrytiBezpechni === stanHry.zahalnaKilkistBezpechnih
        ) {
            stanHry.status = 'peremoga';
            stopTimer();
            onovytyStatusTekst();
            rozkrytyUsiMiny();
            alert('–ü–µ—Ä–µ–º–æ–≥–∞! –£—Å—ñ –±–µ–∑–ø–µ—á–Ω—ñ –∫–ª—ñ—Ç–∏–Ω–∫–∏ –≤—ñ–¥–∫—Ä–∏—Ç—ñ.');
        }
    }

    function rozkrytyUsiMiny() {
        for (let y = 0; y < stanHry.vysota; y++) {
            for (let x = 0; x < stanHry.shyryna; x++) {
                const k = poleHry[y][x];
                if (k.yeMina) {
                    k.isOpened = true;
                }
            }
        }
    }

    function openCell(row, col) {
        if (stanHry.status !== 'u_protsesi') return;
        if (!vMezhahPolya(row, col)) return;

        const klitynka = poleHry[row][col];

        if (klitynka.isOpened || klitynka.isFlagged) return;

        if (timerId === null) {
            startTimer();
        }

        klitynka.isOpened = true;

        if (klitynka.yeMina) {
            stanHry.status = 'porazka';
            stanHry.minaPidryvRow = row;
            stanHry.minaPidryvCol = col;
            stopTimer();
            rozkrytyUsiMiny();
            onovytyStatusTekst();
            alert('–ü–æ—Ä–∞–∑–∫–∞! –í–∏ –Ω–∞—Ç–∏—Å–Ω—É–ª–∏ –Ω–∞ –º—ñ–Ω—É.');
            return;
        }

        stanHry.vidkrytiBezpechni++;

        if (klitynka.kilkistSusidnihMin === 0) {
            for (let dy = -1; dy <= 1; dy++) {
                for (let dx = -1; dx <= 1; dx++) {
                    if (dy === 0 && dx === 0) continue;
                    const ny = row + dy;
                    const nx = col + dx;
                    if (vMezhahPolya(ny, nx)) {
                        openCell(ny, nx);
                    }
                }
            }
        }

        perevirytyPeremohu();
    }

    function toggleFlag(row, col) {
        if (stanHry.status !== 'u_protsesi') return;
        if (!vMezhahPolya(row, col)) return;

        const klitynka = poleHry[row][col];

        if (klitynka.isOpened) return;

        if (klitynka.isFlagged) {
            klitynka.isFlagged = false;
            stanHry.vstanovleniPraportsi--;
        } else {
            if (stanHry.vstanovleniPraportsi >= stanHry.kilkistMin) {
                return; 
            }
            klitynka.isFlagged = true;
            stanHry.vstanovleniPraportsi++;
        }

        onovytyLichylkuPraportsiv();
    }

    function onovytyLichylkuPraportsiv() {
        if (!flagsElement) return;
        const dostupni = stanHry.kilkistMin - stanHry.vstanovleniPraportsi;
        flagsElement.textContent = String(dostupni).padStart(3, '0');
    }

    function onovytyStatusTekst() {
        if (!statusElement) return;
        statusElement.classList.remove('status-hry--peremoga', 'status-hry--porazka');

        if (stanHry.status === 'u_protsesi') {
            statusElement.textContent = '–ì—Ä–∞ —Ç—Ä–∏–≤–∞—î';
        } else if (stanHry.status === 'peremoga') {
            statusElement.textContent = '–ü–µ—Ä–µ–º–æ–≥–∞!';
            statusElement.classList.add('status-hry--peremoga');
        } else if (stanHry.status === 'porazka') {
            statusElement.textContent = '–ü–æ—Ä–∞–∑–∫–∞';
            statusElement.classList.add('status-hry--porazka');
        } else {
            statusElement.textContent = '–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å ¬´–°—Ç–∞—Ä—Ç¬ª';
        }
    }

    function stvorytyDomPole() {
        domKlitynky = [];
        gameFieldElement.innerHTML = '';

        gameFieldElement.style.gridTemplateColumns =
            `repeat(${stanHry.shyryna}, 32px)`;

        for (let y = 0; y < stanHry.vysota; y++) {
            const ryadokDom = [];
            for (let x = 0; x < stanHry.shyryna; x++) {
                const cellEl = document.createElement('div');
                cellEl.classList.add('klityna', 'klityna--zakryta', 'klityna-igrova');
                cellEl.dataset.row = String(y);
                cellEl.dataset.col = String(x);

                cellEl.addEventListener('click', (event) => {
                    const r = Number(event.currentTarget.dataset.row);
                    const c = Number(event.currentTarget.dataset.col);
                    openCell(r, c);
                    vidrenderytyPole();
                    onovytyLichylkuPraportsiv();
                });

                cellEl.addEventListener('contextmenu', (event) => {
                    event.preventDefault();
                    const r = Number(event.currentTarget.dataset.row);
                    const c = Number(event.currentTarget.dataset.col);
                    toggleFlag(r, c);
                    vidrenderytyPole();
                });

                gameFieldElement.appendChild(cellEl);
                ryadokDom.push(cellEl);
            }
            domKlitynky.push(ryadokDom);
        }
    }

    function vidrenderytyPole() {
        for (let y = 0; y < stanHry.vysota; y++) {
            for (let x = 0; x < stanHry.shyryna; x++) {
                const klitynka = poleHry[y][x];
                const el = domKlitynky[y][x];

                el.textContent = '';
                el.className = 'klityna klityna-igrova';

                if (stanHry.status === 'porazka') {
                    if (klitynka.yeMina) {
                        if (y === stanHry.minaPidryvRow && x === stanHry.minaPidryvCol) {
                            el.classList.add('klityna--mina-aktivna');
                            el.textContent = 'üí£';
                        } else if (klitynka.isFlagged) {
                            el.classList.add('klityna--prapor-mina');
                            el.textContent = 'üö©';
                        } else {
                            el.classList.add('klityna--mina');
                            el.textContent = 'üí£';
                        }
                    } else {
                        if (klitynka.isFlagged) {
                            el.classList.add('klityna--prapor-pomylka');
                            el.textContent = 'üö©';
                        } else if (klitynka.isOpened) {
                            el.classList.add('klityna--vidkryta');
                            if (klitynka.kilkistSusidnihMin > 0) {
                                const span = document.createElement('span');
                                span.classList.add('chyslo', 'chyslo--' + klitynka.kilkistSusidnihMin);
                                span.textContent = String(klitynka.kilkistSusidnihMin);
                                el.appendChild(span);
                            }
                        } else {
                            el.classList.add('klityna--zakryta');
                        }
                    }
                    continue;
                }

                if (!klitynka.isOpened) {
                    if (klitynka.isFlagged) {
                        el.classList.add('klityna--prapor-mina');
                        el.textContent = 'üö©';
                    } else {
                        el.classList.add('klityna--zakryta');
                    }
                } else {
                    if (klitynka.yeMina) {
                        el.classList.add('klityna--mina');
                        el.textContent = 'üí£';
                    } else {
                        el.classList.add('klityna--vidkryta');
                        if (klitynka.kilkistSusidnihMin > 0) {
                            const span = document.createElement('span');
                            span.classList.add('chyslo', 'chyslo--' + klitynka.kilkistSusidnihMin);
                            span.textContent = String(klitynka.kilkistSusidnihMin);
                            el.appendChild(span);
                        }
                    }
                }
            }
        }

        onovytyStatusTekst();
    }

    function pochatyNovuHru(rows = 10, cols = 10, mines = 10) {
        stopTimer();
        secondsPassed = 0;
        onovytyVidobrazhennyaTaimeru();

        stanHry.vysota = rows;
        stanHry.shyryna = cols;
        stanHry.kilkistMin = mines;
        stanHry.status = 'u_protsesi';
        stanHry.vidkrytiBezpechni = 0;
        stanHry.zahalnaKilkistBezpechnih = rows * cols - mines;
        stanHry.vstanovleniPraportsi = 0;
        stanHry.minaPidryvRow = null;
        stanHry.minaPidryvCol = null;

        poleHry = generateField(rows, cols, mines);

        stvorytyDomPole();
        onovytyLichylkuPraportsiv();
        vidrenderytyPole();

        if (newGameButtonText) {
            newGameButtonText.textContent = '–†–µ—Å—Ç–∞—Ä—Ç';
        }

        console.log('–ù–æ–≤–∞ –≥—Ä–∞. –ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–µ –ø–æ–ª–µ:', poleHry);
        console.log('–ü–æ—á–∞—Ç–∫–æ–≤–∏–π —Å—Ç–∞–Ω –≥—Ä–∏:', stanHry);
    }

    newGameButton.addEventListener('click', () => {
        pochatyNovuHru(10, 10, 10);
    });

    onovytyVidobrazhennyaTaimeru();
    onovytyLichylkuPraportsiv();
    onovytyStatusTekst();
</script>
</body>
</html>
